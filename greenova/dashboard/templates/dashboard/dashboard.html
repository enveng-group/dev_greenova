{% extends "base.html" %}
{% load static dashboard_tags %}

{% block title %}
  Dashboard
{% endblock title %}

{% block main %}
  <article>
    <header>
      <hgroup>
        <h1>Hi {{ request.user|display_name }}</h1>
        <h2>
          Welcome to Enveng Groups ECMS where we make managing and tracking complex environmental commitments and obligations a whole lot easier for you.
        </h2>
      </hgroup>
    </header>
    <!-- Project Selection -->
    {% include "projects/projects_selector.html" %}
    <!-- Charts Container with HTMX -->
    <div class="project-data-container">
      <!-- Existing chart container -->
      <div id="chart-container"
           hx-get="{% url 'mechanisms:mechanism_charts' %}"
           hx-trigger="load"
           hx-include="[name='project']"
           hx-target="#chart-container"
           hx-swap="innerHTML">
        <div class="notice" role="status">
          <p>Please select a project to view mechanism charts.</p>
        </div>
      </div>

      <!-- New obligations container -->
      <div id="obligations-container"
           hx-get="{% url 'obligations:obligation_summary' %}"
           hx-trigger="load"
           hx-include="[name='project']"
           hx-target="#obligations-container"
           hx-swap="innerHTML">
        <div class="notice" role="status">
          <p>Please select a project to view obligations.</p>
        </div>
      </div>
    </div>
  </article>
{% endblock main %}

{% block footer %}
  <footer role="contentinfo">
    <!-- Dashboard-specific footer content -->
    <p>
      System Status:
      <mark>{{ system_status }}</mark> |
      Version: {{ app_version }} |
      Last Updated: {{ last_updated|date:"j M Y" }}
    </p>
    <p>
      Need help? Contact
      <a href="mailto:support@enveng-group.com.au">support@enveng-group.com.au</a>
    </p>
  </footer>
  <!-- Include the base template's footer content after dashboard footer -->
  {{ block.super }}
{% endblock footer %}
