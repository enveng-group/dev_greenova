{% load static %}
{% load django_htmx %}
{% load tailwind_tags %}
{% load user_tags %}
{% load core_tags %}
<!DOCTYPE html>
<html lang="en" data-theme="light dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <meta name="color-scheme" content="light dark" />
        <meta name="keywords"
              content="environmental compliance, management system, greenova, sustainability" />
        <meta name="description"
              content="Greenova - Environmental Compliance Management System" />
        <title>
            {% block title %}Greenova{% endblock %}
            | Environmental Management
        </title>
        <!-- Critical CSS -->
        <link rel="preload" href="{% static 'css/styles.css' %}" as="style" />
        {% tailwind_preload_css %}
        <!-- CSS files -->
        <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
        {% tailwind_css %}
        {% block extra_head %}{% endblock %}
        <!-- Load theme initialization script -->
        <script src="{% static 'js/theme-init.js' %}"></script>
        <!-- Load hyperscript -->
        <script src="{% static 'js/vendor/_hyperscript.min.js' %}" defer></script>
    </head>
    <body hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
          hx-ext="head-support, loading-states, class-tools, path-deps">
        <!-- Skip to main content link for accessibility -->
        <a class="skip-link" href="#main-content">Skip to content</a>
        {% load hyperscript %}
        <!-- Header with semantic nav -->
        <header role="banner">
            <nav role="navigation" aria-label="Main navigation">
                <ul role="menubar">
                    <!-- Left aligned navigation items -->
                    <li role="none" class="menubar-breadcrumbs">{% breadcrumb_navigation %}</li>
                    <!-- Right aligned navigation items -->
                    <li role="none" class="navigation-items">
                        {% if user.is_authenticated %}
                            <!-- Main navigation items for authenticated users -->
                            <a href="{% url 'dashboard:home' %}"
                               role="menuitem"
                               {% if request.path == '/dashboard/' %}aria-current="page"{% endif %}>Dashboard</a>
                            <a href="{% url 'users:profile' %}"
                               role="menuitem"
                               {% if request.path == '/users/profile/' %}aria-current="page"{% endif %}>Profile</a>
                            {% if request.user.is_staff %}
                                <a href="{% url 'company:list' %}"
                                   role="menuitem"
                                   {% if '/company/' in request.path %}aria-current="page"{% endif %}>Companies</a>
                            {% endif %}
                            <a href="{% url 'account_logout' %}" role="menuitem">Logout</a>
                        {% else %}
                            <!-- Auth links for unauthenticated users -->
                            <a href="{% url 'account_login' %}"
                               role="menuitem"
                               {% if request.path == '/accounts/login/' %}aria-current="page"{% endif %}>Login</a>
                            <a href="{% url 'account_signup' %}"
                               role="menuitem"
                               {% if request.path == '/accounts/signup/' %}aria-current="page"{% endif %}>Register</a>
                        {% endif %}
                        <!-- Theme switcher always visible -->
                        {% theme_switcher %}
                    </li>
                </ul>
            </nav>
        </header>
        <!-- Main content -->
        <main id="main-content" role="main">
            {% block content %}
            {% endblock content %}
        </main>
        <!-- Footer -->
        <footer>
            {% block footer %}
                <p>&copy; {% now "Y" %} Greenova Environmental Management System</p>
            {% endblock footer %}
        </footer>
        <!-- Include chat widget -->
        {% load chatbot_tags %}
        {% chat_widget %}
        <!-- Django HTMX -->
        {% django_htmx_script %}
        <!-- JavaScript -->
        <script src="{% static 'js/vendor/htmx/htmx.min.js' %}"></script>
        <script src="{% static 'js/vendor/htmx/ext/head-support.min.js' %}"></script>
        <script src="{% static 'js/vendor/htmx/ext/loading-states.min.js' %}"></script>
        <script src="{% static 'js/vendor/htmx/ext/class-tools.min.js' %}"></script>
        <script src="{% static 'js/vendor/htmx/ext/path-deps.min.js' %}"></script>
        <script src="{% static 'js/app.js' %}"></script>
    </body>
</html>
